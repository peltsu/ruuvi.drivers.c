<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>ruuvi.drivers.c: Atomic functions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ruuvi.drivers.c
   &#160;<span id="projectnumber">0.1.3</span>
   </div>
   <div id="projectbrief">Drivers for external sensors and peripherals on embedded systems.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group___atomic.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Atomic functions</div>  </div>
</div><!--header-->
<div class="contents">

<p>Functions for atomic operations.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:ruuvi__interface__atomic_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ruuvi__interface__atomic_8h.html">ruuvi_interface_atomic.h</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:gae2abb6fd852678d7c3f2e8aadf009346"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___atomic.html#gae2abb6fd852678d7c3f2e8aadf009346">RI_ATOMIC_FLAG_INIT</a>&#160;&#160;&#160;0</td></tr>
<tr class="memdesc:gae2abb6fd852678d7c3f2e8aadf009346"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initial value for atomic flag.  <a href="#gae2abb6fd852678d7c3f2e8aadf009346">More...</a><br/></td></tr>
<tr class="separator:gae2abb6fd852678d7c3f2e8aadf009346"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:gadcdbd02fd03e2dee90320d97107d04c3"><td class="memItemLeft" align="right" valign="top">typedef volatile uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___atomic.html#gadcdbd02fd03e2dee90320d97107d04c3">ri_atomic_t</a></td></tr>
<tr class="memdesc:gadcdbd02fd03e2dee90320d97107d04c3"><td class="mdescLeft">&#160;</td><td class="mdescRight">define atomic type - not portable to 8-bit.  <a href="#gadcdbd02fd03e2dee90320d97107d04c3">More...</a><br/></td></tr>
<tr class="separator:gadcdbd02fd03e2dee90320d97107d04c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga598458765c18e4e1a78a2231c66a89f7"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___atomic.html#ga598458765c18e4e1a78a2231c66a89f7">ri_atomic_flag</a> (<a class="el" href="group___atomic.html#gadcdbd02fd03e2dee90320d97107d04c3">ri_atomic_t</a> *const flag, const bool set)</td></tr>
<tr class="memdesc:ga598458765c18e4e1a78a2231c66a89f7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Atomic flag check and set/clear function.  <a href="#ga598458765c18e4e1a78a2231c66a89f7">More...</a><br/></td></tr>
<tr class="separator:ga598458765c18e4e1a78a2231c66a89f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Functions for atomic operations. </p>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="gae2abb6fd852678d7c3f2e8aadf009346"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RI_ATOMIC_FLAG_INIT&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initial value for atomic flag. </p>

<p>Definition at line <a class="el" href="ruuvi__interface__atomic_8h_source.html#l00023">23</a> of file <a class="el" href="ruuvi__interface__atomic_8h_source.html">ruuvi_interface_atomic.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="gadcdbd02fd03e2dee90320d97107d04c3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef volatile uint32_t <a class="el" href="group___atomic.html#gadcdbd02fd03e2dee90320d97107d04c3">ri_atomic_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>define atomic type - not portable to 8-bit. </p>

<p>Definition at line <a class="el" href="ruuvi__interface__atomic_8h_source.html#l00025">25</a> of file <a class="el" href="ruuvi__interface__atomic_8h_source.html">ruuvi_interface_atomic.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga598458765c18e4e1a78a2231c66a89f7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ri_atomic_flag </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group___atomic.html#gadcdbd02fd03e2dee90320d97107d04c3">ri_atomic_t</a> *const&#160;</td>
          <td class="paramname"><em>flag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>set</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Atomic flag check and set/clear function. </p>
<p>Uses whatever mechanism underlying platform provides to check and set or clear flag. When implementing mutex, check-and-set flag to reserve a mutex and check-and-clear to free it.</p>
<p>Generally used like this: </p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code" href="group___atomic.html#gadcdbd02fd03e2dee90320d97107d04c3">ri_atomic_t</a> readlock;</div>
<div class="line"><span class="keywordflow">if</span>(!<a class="code" href="group___atomic.html#ga598458765c18e4e1a78a2231c66a89f7">ri_atomic_flag</a>(&amp;readlock, <span class="keyword">true</span>))  { <span class="keywordflow">return</span> RUUVI_LIBRARY_ERROR_CONCURRENCY; }</div>
<div class="line">do_some_critical_stuff();</div>
<div class="line"><span class="keywordflow">if</span>(!<a class="code" href="group___atomic.html#ga598458765c18e4e1a78a2231c66a89f7">ri_atomic_flag</a>(&amp;readlock, <span class="keyword">false</span>)){ <span class="keywordflow">return</span> RUUVI_LIBRARY_ERROR_FATAL; }</div>
</div><!-- fragment --><p>It's important to return if lock can't be had rather than busylooping: if the interrupt level which fails to get lock is higher than the call which has the lock program will deadlock in the busyloop. Likewise failure to release the lock will cause deadlock in the next execution, fail immediately.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">flag</td><td>uint32_t address of bitfield to check. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">set</td><td>true to set flag, false to clear flag. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>true</code> if operation was successful. <code>false</code> otherwise. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
